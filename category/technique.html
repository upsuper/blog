<!DOCTYPE html>
<html lang="en">
<head>
        <title>鬼の领地 - Technique</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
                <link href="http://upsuper.github.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="鬼の领地 Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">鬼の领地 </a></h1>
                <nav><ul>
                                                                                                    <li ><a href="../category/blog.html">Blog</a></li>
                                    <li ><a href="../category/research.html">Research</a></li>
                                    <li ><a href="../category/script.html">Script</a></li>
                                    <li ><a href="../category/study.html">Study</a></li>
                                    <li class="active"><a href="../category/technique.html">Technique</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../automatically-run-top-in-tty.html">在 tty 里添加一个开机自启动的任务管理器</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2010-03-31T10:31:00">
                三 31 三月 2010
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/technique.html">Technique</a>. </p>
<p>tags: <a href="../tag/linux.html">Linux</a></p>
</footer><!-- /.post-info --><p>每当感觉到系统卡的时候，最好的方法无外乎进入 tty，登入，打开一个 <code>top</code> 监视。可是每次到了需要的时候才去开，打开的效率自然不敢恭维。于是便想，每次开机的时候，记起来就跑到 tty 下面去先开起来。不过这件事情总归是麻烦的，于是才有了现在的方案。</p>
<p>既然 tty 那么多，那我们就把他利用一下吧~让他开机自动在某个 tty 里面启动 <code>top</code> 无疑最方便了~</p>
<p>首先呢，我找到了 Ubuntu 里面 tty 配置存放的地方 <code>/etc/init/ttyX.conf</code>，其中的 X 便是 tty 的编号，我这里选择了 <code>tty6.conf</code>。打开这个文件，结构简单极了，看到里面</p>
<div class="codehilite"><pre><span class="nb">exec</span> /sbin/getty -8 38400 tty6
</pre></div>


<p>就知道，肯定和 <code>getty</code> 有关系。<code>man getty</code> 里面查到可以通过 <code>-l</code> 参数设置登入程序替代 <code>/bin/login</code>。查了一下 <code>man login</code>，发现可以通过 <code>-f username</code> 的方式不进行验证地登入。</p>
<p>于是我就在 <code>/bin</code> 下面新建了一个 <code>autologin</code> 文件（其实理论上放哪里都可以，不过最好要用 root 权限创建，不然可以乱改就不好了），里面写上</p>
<div class="codehilite"><pre><span class="c">#!/bin/sh</span>
/bin/login -f upsuper
</pre></div>


<p>给这个文件加上可执行属性，接着将 <code>/etc/init/tty6.conf</code> 里面刚才那一行改成</p>
<div class="codehilite"><pre><span class="nb">exec</span> /sbin/getty -8 -l <span class="s1">&#39;/bin/autologin&#39;</span> 38400 tty6
</pre></div>


<p>重启。</p>
<p>进入 tty6 发现没有效果，还是提示用户名，无语……于是输入了用户名 upsuper，结果发现没有要求密码，直接进入了。我退出登入，再输入 root，发现依然没有要求密码而直接进入了 upsuper 权限。</p>
<p>再查查 <code>man getty</code>，发现那个请求用户名是 <code>getty</code> 输出的，里面提到了 <code>-n</code> 参数，可以消除对用户名的请求，以及 <code>-i</code> 参数，不输出请求前的文字（在我的 Ubuntu 里面就是“Ubuntu 9.10”）。于是上面那行被改成了</p>
<div class="codehilite"><pre><span class="nb">exec</span> /sbin/getty -8in -l <span class="s1">&#39;/bin/autologin&#39;</span> 38400 tty6
</pre></div>


<p>重新启动，发现已经可以自动进入。</p>
<p>不过我要的不是这个效果~</p>
<p>其实简单地说，我那个要实现也不难，按照现在的情况，就是在 <code>~/.bashrc</code> 里面加上一行判断的事情了。不过我可不想这样。这样的话如果退出了 <code>top</code> 就会进入命令行。我的想法是，永远不让他进入命令行，这样看过去比较爽~</p>
<p>于是我就倒腾起了 <code>login</code> 程序的 <code>FAKE_SHELL</code>，如果在 <code>autologin</code> 脚本里改变环境变量，根本影响不了 <code>login</code> 程序，无论我改 <code>FAKE_SHELL</code>，还是 <code>SHELL</code>，都没有用，<code>login</code> 仍然义无反顾地进入了 <code>bash</code>……</p>
<p>最后我就想，唉，其实 <code>autologin</code> 脚本就是一正常脚本，只不过在登入的时候以 root 权限运行嘛，那我直接在里面运行 <code>top</code> 不久行了~考虑到权限因素，就是用 <code>su</code> 把权限改一下，不就解决问题了么？</p>
<p>于是最终版的 <code>autologin</code> 就出炉了：</p>
<div class="codehilite"><pre><span class="c">#!/bin/sh</span>
su -c <span class="s1">&#39;/usr/bin/top&#39;</span> upsuper
</pre></div>


<p>这个最后效果是什么样的呢？就是 <code>top</code> 以我的用户权限运行，然后点击 <code>q</code> 退出就会重新启动一个 <code>top</code>。这就是我要得效果了~很好很强大~算是合理的利用了一个 tty 了。现在只要点击 Ctrl-Alt-F6 就可以有现成的任务管理器了~</p>
<p>其实根据这个思路，tty 可以做的事情还很多。本来那个什么 <code>-l</code> 啦，<code>-n</code> 什么的，是拿来做自定义登入验证方式的，我觉得这个也大有文章可做~最后再感叹一下，Linux 实在太强大了~</p>
<p>补充：</p>
<p>这篇文章被我投递到了 LinuxTOY 上面，然后下面有人提到使用 <code>htop</code> 代替 <code>top</code>，我试了一下，貌似 <code>htop</code> 的资源占用要比 <code>top</code> 高出许多，因此我最后没有替换。</p>
<p>不过 <code>htop</code> 貌似确实好用很多，如果需要的话，只要安装 <code>htop</code> 后（Ubuntu 源里是有的），然后把 <code>autologin</code> 里面的</p>
<div class="codehilite"><pre>su -c <span class="s1">&#39;/usr/bin/top&#39;</span> upsuper
</pre></div>


<p>改成</p>
<div class="codehilite"><pre>su -c <span class="s1">&#39;/usr/bin/htop&#39;</span> upsuper
</pre></div>


<p>下面只要进入那个 tty 点 <code>q</code> 退出当前 <code>top</code>，马上就会自动替换为 <code>htop</code> 启动了~</p>                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../little-vc6-fix.md.html" rel="bookmark"
                           title="Permalink to 写了个小小的 vc-fix">写了个小小的 vc-fix</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-03-21T10:40:00">
                日 21 三月 2010
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/technique.html">Technique</a>. </p>
<p>tags: <a href="../tag/c.html">C</a><a href="../tag/microsoft.html">Microsoft</a></p>
</footer><!-- /.post-info -->                <p>我们的 C++ 老师给我布置了 C++ 的大作业来替代其他同学交的无聊题目。大作业的第一题就是完整的高精度库，并且要求使用运算符重载。因为原来用 C 写过，这次写，思路上没有太大问题，不过全部程序被我 C++ 化了，代码看过去很诡异……呃……</p>
<p>我自己的机子上，自然使用 g++ 编译，不过我猜老师会要求 VC6 能够编译……我就用<a href="./simple-script-for-using-vc6-compiler.html">上次安装的 VC6</a> 编译了一下，发现好几个错误和无数警告……其实也是我意料之中的。</p>
<p>其中我觉得最讨厌的莫过于 <code>for</code> 循环的循环变量不被视为 <code>for</code> 循环的局部变量这一点，导致大量变量被其认为是重复定义，这个是 VC6 和标准就语言上相去最远的问题了……不想每个都去改，麻烦死了。</p>
<p>在网上一找，还真找到一个简单的方法：</p>
<div class="codehilite"><pre><span class="cp">#define for if(0) ; else for</span>
</pre></div>


<p>其实我也不知道这个是什么机理 ...</p>
                <a class="readmore" href="../little-vc6-fix.md.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../replacing-css-via-jquery.html" rel="bookmark"
                           title="Permalink to 基于 jQuery 的 CSS 更换术">基于 jQuery 的 CSS 更换术</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2009-10-18T20:57:00">
                日 18 十月 2009
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/technique.html">Technique</a>. </p>

</footer><!-- /.post-info -->                <p>最近开始写一中的新选歌系统，这次要大改，顺便练手。</p>
<p>想加入换肤功能（不然女生肯定觉得老是蓝色不好……），而且我想到的换肤，最简单的方式就是换 CSS，把界面颜色、图形相关的内容放入皮肤的 CSS 中就很容易了~不过问题是换肤呢？</p>
<p>正好新系统中因为客户端代码可能非常强大，准备引入 jQuery 框架来简化开发，便学了一些。于是我就想，能不能通过 jQuery 来解决呢？</p>
<p>首先，我给出了下面这个简单的页面：</p>
<div class="codehilite"><pre><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span>
<span class="cp">  &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999 ...</span></pre></div>
                <a class="readmore" href="../replacing-css-via-jquery.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../php-show-latex-formula.html" rel="bookmark"
                           title="Permalink to PHP 空间也做 LaTeX 公式显示">PHP 空间也做 LaTeX 公式显示</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2009-04-03T10:43:00">
                五 03 四月 2009
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/technique.html">Technique</a>. </p>
<p>tags: <a href="../tag/php.html">PHP</a><a href="../tag/latex.html">LaTeX</a></p>
</footer><!-- /.post-info -->                <p>原来一直以为只有自己的机子安装了 LaTeX、dvips 等等这些软件才能显示 LaTeX 公式。</p>
<p>今天上网查找了一下，发现不是这样的，原来比较基本的 LAMP 空间也可以这样了，这完全得益于一个叫做 mimeTeX 的开源软件。虽然这个软件生成的没有 LaTeX 生成的漂亮，不过还是比 Word 的公式编辑器生成的漂亮，最重要的是可以在网站上使用！</p>
<p>要安装这个，有一个比较必要的前提，就是你的网站必须不能运行在 PHP 的安全模式下，还有就是网站必须允许是用 .htaccess 配置文件，否则可能不行……不是……是肯定不行……另外权限设置比较严格的服务器上注意把相应权限设置妥当。</p>
<p>如果服务器是 Linux 平台下的，首先，我们要下载这个软件，源代码可以点击这里下载：<a href="http://www.forkosh.com/mimetex.zip">mimetex.zip</a>。这里推荐解压后直接上传整个文件夹的代码上去，因为最好可以在服务器端编译，而非客户端编译好，否则平台可能不兼容。在解压出来的文件目录中新建一个 complie.php 文件，其中输入 ...</p>
                <a class="readmore" href="../php-show-latex-formula.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>