<!DOCTYPE html>
<html lang="en">
<head>
        <title>鬼の领地 - Script</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
                <link href="http://upsuper.github.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="鬼の领地 Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../">鬼の领地 </a></h1>
                <nav><ul>
                                                                                                    <li ><a href="../category/blog.html">Blog</a></li>
                                    <li ><a href="../category/research.html">Research</a></li>
                                    <li class="active"><a href="../category/script.html">Script</a></li>
                                    <li ><a href="../category/study.html">Study</a></li>
                                    <li ><a href="../category/technique.html">Technique</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
                
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../dynamic-modify-cpu-number.html">动态切换 Linux 使用的 CPU 数量</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2011-10-19T14:04:00">
                2011&#24180;10&#26376;19&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/script.html">Script</a>. </p>
<p>tags: <a href="../tag/linux.html">Linux</a></p>
</footer><!-- /.post-info --><p>由于要测试一些代码，其运行结果会受到多核并行的影响，所以希望能够调整使用的 CPU 数量。网络上之前看到的方法是在内核的启动参数上添加一个 <code>maxcpus</code>，但是如果这样的话每切换一次都要重启一次，是在太麻烦了。想想 Linux 应该是很强大的，所以可以动态修改 CPU 数量才对。</p>
<p>无意中看到 Linux 代码的 <code>Documentation</code> 文件夹下有个文件叫做 <code>cpu-hotplug.txt</code>，于是就看了一下，发现可以在 <code>/sys/devices/system/cpu</code> 看到代表各 CPU 的文件夹按照 <code>cpuX</code> 的命名方式，如 <code>cpu0</code>、<code>cpu1</code>、<code>cpu2</code> 等。这些文件夹里面有一个 <code>online</code> 文件，如果其值为0则禁用该 CPU，如果为1则启用该 CPU。注意，这里需要 <code>root</code> 权限哦。</p>
<p>因为我只要在单核和多核之间切换，所以我写了两个脚本放在 <code>/usr/local/sbin</code> 里面：</p>
<p>singlecore</p>
<div class="codehilite"><pre><span class="c">#!/bin/bash</span>

<span class="nv">cpus_dir</span><span class="o">=</span><span class="s2">&quot;/sys/devices/system/cpu&quot;</span>

<span class="k">for </span>cpu in <span class="k">$(</span>ls <span class="s2">&quot;$cpus_dir&quot;</span> | grep <span class="s1">&#39;cpu[0-9]\+&#39;</span><span class="k">)</span>
<span class="k">do</span>
<span class="k">    </span><span class="nv">cpu_online</span><span class="o">=</span><span class="s2">&quot;$cpus_dir/$cpu/online&quot;</span>
    <span class="k">if</span> <span class="o">[[</span> -e <span class="s2">&quot;$cpu_online&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">$(</span>cat <span class="nv">$cpu_online</span><span class="k">)</span> <span class="o">=</span> 1 <span class="o">]]</span>
    <span class="k">then</span>
<span class="k">        </span><span class="nb">echo </span>0 &gt; <span class="s2">&quot;$cpu_online&quot;</span>
    <span class="k">fi</span>
<span class="k">done</span>
</pre></div>


<p>multicore</p>
<div class="codehilite"><pre><span class="c">#!/bin/bash</span>

<span class="nv">cpus_dir</span><span class="o">=</span><span class="s2">&quot;/sys/devices/system/cpu&quot;</span>

<span class="k">for </span>cpu in <span class="k">$(</span>ls <span class="s2">&quot;$cpus_dir&quot;</span> | grep <span class="s1">&#39;cpu[0-9]\+&#39;</span><span class="k">)</span>
<span class="k">do</span>
<span class="k">    </span><span class="nv">cpu_online</span><span class="o">=</span><span class="s2">&quot;$cpus_dir/$cpu/online&quot;</span>
    <span class="k">if</span> <span class="o">[[</span> -e <span class="s2">&quot;$cpu_online&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">$(</span>cat <span class="nv">$cpu_online</span><span class="k">)</span> <span class="o">=</span> 0 <span class="o">]]</span>
    <span class="k">then</span>
<span class="k">        </span><span class="nb">echo </span>1 &gt; <span class="s2">&quot;$cpu_online&quot;</span>
    <span class="k">fi</span>
<span class="k">done</span>
</pre></div>


<p>之后需要切换的时候，只要运行 <code>sudo singlecore</code> 或者 <code>sudo multicore</code> 就可以了~</p>
<p>顺便说一句，我当时在想，如果我禁用了所有的 CPU 会怎么样呢？结果发现 <code>cpu0</code> 是没有 <code>online</code> 文件的，也就是 Linux 至少保证一个 CPU 处于可用状态。</p><p>There are <a href="../dynamic-modify-cpu-number.html#disqus_thread">comments</a>.</p>                </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../two-scripts-for-fanfou.html" rel="bookmark"
                           title="Permalink to 关于饭否的两个小脚本">关于饭否的两个小脚本</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2011-02-02T12:06:00">
                2011&#24180;02&#26376;02&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/script.html">Script</a>. </p>
<p>tags: <a href="../tag/fanfou.html">Fanfou</a><a href="../tag/python.html">Python</a></p>
</footer><!-- /.post-info -->                <p>前几天因为某些原因，我把饭否上所有的好友和关注者全部清空了。当然，如果没有程序的帮忙，估计还不等我删完我也就后悔了。</p>
<p>我没有那么狠心的把饭否的消息给清空，因为消息是不可恢复的（而且也太多了），但好友和关注者是可以的。做事情都给自己留后路显然是我一贯的风格，不然的话，我大概早从我家阳台跳下去了……</p>
<p>两段脚本都不长，第一段是备份饭否的好友列表和关注者列表的，做的毫无泛用性，因为 bash 编程我并不很熟，只知道可以用 <code>wget</code> 来抓取。本来这种事情其实可以直接用 API 抓的，不过我想抓下我能直接看的东西，所以最终还是导出了 Cookie 抓网页。</p>
<p>第一段代码如下：</p>
<div class="codehilite"><pre><span class="c">#!/bin/bash</span>

mkdir friends
<span class="k">for </span>i in <span class="o">{</span>1..11<span class="o">}</span>
<span class="k">do</span>
<span class="k">    </span>wget -k -e <span class="nv">robots</span><span class="o">=</span>off --load-cookies cookies.txt -P friends/ <span class="se">\</span>
        http ...</pre></div>
                <a class="readmore" href="../two-scripts-for-fanfou.html">read more</a>
                <p>There are <a href="../two-scripts-for-fanfou.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../finding-higher-imitation-of-id-2.html" rel="bookmark"
                           title="Permalink to 寻找更高仿的 ID 第二季">寻找更高仿的 ID 第二季</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-09-11T15:31:00">
                2010&#24180;09&#26376;11&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/script.html">Script</a>. </p>
<p>tags: <a href="../tag/python.html">Python</a><a href="../tag/tieba.html">Tieba</a></p>
</footer><!-- /.post-info -->                <p>继上一篇文章之后，我又下大力气对这个程序做了许多修改，在精确度和速度方面似乎都有些许提高。在此推出第二季~</p>
<h2>使用真正的 12px 宋体</h2>
<p>在上一次的程序中使用的 PIL 似乎是因为不支持宋体 <code>ttc</code> 文件中对于小字体下优化的点阵形式，才在选择小于 <code>19px</code> 的字号时不能正确渲染汉字。考虑到这一点，我就想到把 <code>ttc</code> 文件里面 <code>12px</code> 的点阵字体单独提取出来使用，毕竟贴吧上面显示 ID 都是用这个字号显示的。</p>
<p>使用 FontForge 提取出来了 <code>simsun-12.bdf</code> 文件，就是宋体 <code>12px</code> 下的点阵。参考 PIL 的手册，发现 PIL 不能直接使用 <code>.bdf</code> 文件，需要使用一个叫做 <code>pilfont</code> 的脚本转换成专有的 <code>.pil</code> 文件才行。我想转换就转换呗。<code>simsun-12.bdf</code> 一个 ...</p>
                <a class="readmore" href="../finding-higher-imitation-of-id-2.html">read more</a>
                <p>There are <a href="../finding-higher-imitation-of-id-2.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../finding-higher-imitation-of-id.html" rel="bookmark"
                           title="Permalink to 寻找更高仿的 ID">寻找更高仿的 ID</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-09-09T18:22:00">
                2010&#24180;09&#26376;09&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/script.html">Script</a>. </p>
<p>tags: <a href="../tag/python.html">Python</a><a href="../tag/tieba.html">Tieba</a></p>
</footer><!-- /.post-info -->                <p>今天大学军训完了，不想做什么正经事，就想到前一段时间想做的寻找相似汉字的程序，用以寻找更高仿的贴吧 ID。用程序来寻找相似汉字，从另一个角度，也是从 Matrix67 大牛的一篇日志里得到的启发。不过 Matrix67 大牛使用的是 Mathematica 来寻找，我不大会 Mathematica，就想用我熟悉的 Python 来解决，毕竟 Python 是一个很强大的东西~</p>
<p>其实寻找的思路很简单，就是把某个汉字当作图片弄出来，让后对比两个图片的相似程度。因此做这个程序的第一步就是研究如何用 Python 处理图片和文字。Python 有一个非常著名的第三方库，名叫 Python Imaging Library，简称 PIL，就是专门用来处理图片的。</p>
<h2>文字 to 图像</h2>
<p>PIL 可以很轻松的将文字转换为图像，并且提供了虽然不能说是强大，但暂时够用的图像处理函数。</p>
<p>处理文字生成的图像，显然和彩色没有太大关系，因此可以使用灰度图像节省计算需要的空间和时间。此外我们知道，文字到图像有一个中间媒介 ...</p>
                <a class="readmore" href="../finding-higher-imitation-of-id.html">read more</a>
                <p>There are <a href="../finding-higher-imitation-of-id.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../bmp-to-html-tool.html" rel="bookmark"
                           title="Permalink to BMP to HTML 小程序">BMP to HTML 小程序</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2010-03-10T17:46:00">
                2010&#24180;03&#26376;10&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/script.html">Script</a>. </p>
<p>tags: <a href="../tag/erlang.html">Erlang</a><a href="../tag/html.html">HTML</a></p>
</footer><!-- /.post-info -->                <p>什么叫 BMP 到 HTML 呢……？就是生成一个网页，里面用不同颜色的字符拼出那个图片……很无聊的功能嗯，而且原理上说，生成的 HTML 文件如果要表现整个 BMP 的所有细节，大小肯定大大超过原 BMP 文件……</p>
<p>为什么会做这个呢？主要是受到我们 C++ 老师的启发，尝试去做的。不过我没有用 C++ 写，而是选用了寒假学的 Erlang，这也是我写的第一个 Erlang 程序。</p>
<p>为什么会选用 Erlang 呢？主要是基于两点原因：1、寒假学了半天，一点都没有练过，就拿这个来练练；2、看中了 Erlang 强大的模式匹配和比特语法。比特语法在 Erlang 里面原来是用来解决网络传输协议中的二进制数据的，不过这里拿来处理二进制文件着实是一个很好的选择~不过其实 Erlang 真正最重要的特性：面向并发 ...</p>
                <a class="readmore" href="../bmp-to-html-tool.html">read more</a>
                <p>There are <a href="../bmp-to-html-tool.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../simple-script-for-using-vc6-compiler.html" rel="bookmark"
                           title="Permalink to 方便使用 VC6 编译器的小脚本">方便使用 VC6 编译器的小脚本</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2009-12-30T18:46:00">
                2009&#24180;12&#26376;30&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/script.html">Script</a>. </p>
<p>tags: <a href="../tag/c.html">C</a><a href="../tag/sh.html">sh</a><a href="../tag/wine.html">wine</a></p>
</footer><!-- /.post-info -->                <p>因为一些原因，有时候不得不在 Linux 下使用 VC6 编译器。（比如学校的作业要求能在 VC6 下编译通过之类的要求）之前的用法太麻烦了，要把待编译的文件复制到 VC6 的安装目录，还要写很长的一串东西。要是能像调用 GCC 那么方便就好了~</p>
<p>于是就有了下面这个小脚本：</p>
<div class="codehilite"><pre><span class="c">#!/bin/bash</span>
<span class="c"># - * - coding: UTF-8 - * -</span>

<span class="nv">VC6_DIR</span><span class="o">=</span><span class="s2">&quot;这里写上VC6的安装地址&quot;</span>

<span class="nv">BIN</span><span class="o">=</span><span class="s2">&quot;$VC6_DIR/VC98/Bin&quot;</span>
<span class="nb">export </span><span class="nv">INCLUDE</span><span class="o">=</span><span class="s2">&quot;$VC6_DIR/VC98/Include&quot;</span>
<span class="nb">export </span><span class="nv">LIB</span><span class="o">=</span><span class="s2">&quot;$VC6_DIR/VC98/Lib&quot;</span>

<span class="nv">ARGS</span><span class="o">=</span>

<span class="k">while </span><span class="nb">getopts</span> <span class="s2">&quot;o:c&quot;</span> optname
<span class="k">do</span>
<span class="k">  case</span> <span class="s2">&quot;$optname&quot;</span> in
  <span class="s2">&quot;o&quot;</span><span class="o">)</span>
    <span class="nv">ARGS ...</span></pre></div>
                <a class="readmore" href="../simple-script-for-using-vc6-compiler.html">read more</a>
                <p>There are <a href="../simple-script-for-using-vc6-compiler.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1><a href="../use-mouse-as-music-player-controller.html" rel="bookmark"
                           title="Permalink to 鼠标控制音乐播放的小程序">鼠标控制音乐播放的小程序</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
        <abbr class="published" title="2009-11-03T20:06:00">
                2009&#24180;11&#26376;03&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="../author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="../category/script.html">Script</a>. </p>
<p>tags: <a href="../tag/python.html">Python</a><a href="../tag/gtk.html">GTK</a></p>
</footer><!-- /.post-info -->                <p>看这个标题一定很奇怪：难道我以前控制音乐播放不用鼠标么？这个文章的标题看起来像鼠标刚刚发明的推广期的文章……不过，当然不是这样的！</p>
<p>其实只是想：如何把我的小本合上放书架上，当作一个音乐播放器+功放，并用我的无线6键鼠当遥控器遥控控制之。</p>
<p>想想其实还是蛮有意义的功能，这样我做作业的时候可以不用戴耳机，不用用MP3，直接把本当播放器；同时，我不会看到屏幕上的东西，可以安心做作业~再看看我的6键无限鼠，那额外的功能键平时根本不用，也想不出能有什么用……这么好的东西就这样被我浪费了……（话说，拿本当音乐播放器是不是更浪费？）</p>
<p>说干就干！</p>
<p>首先提出构想：左键用于暂停和播放，滚轮调节音量，侧边的两个功能键用来切换上一首和下一首。至于右键和中键……再说吧，说不定以后可以扩展更多功能？说不定以后高兴了弄个鼠标手势什么的~嘿嘿</p>
<p>接下来查找资料。印象中我的 Audacious 是可以用 D-Bus 控制的。简单地查阅了一下相关资料，发现了一个叫做 MPRIS 的播放器控制接口。为此，我还专门学习了一下 python-dbus 的使用。</p>
<p>插一句话：python-dbus 怎么没有中文教程啊 ...</p>
                <a class="readmore" href="../use-mouse-as-music-player-controller.html">read more</a>
                <p>There are <a href="../use-mouse-as-music-player-controller.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 1
    </p>
                        </section><!-- /#content -->
                    <section id="extras" class="body">
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://upsuper.github.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="https://twitter.com/upsuperx">Twitter</a></li>
                                                    <li><a href="https://github.com/upsuper">GitHub</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4908719-6']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'upsuper-github';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>