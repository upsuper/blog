<!DOCTYPE html>
<html lang="en">
<head>
        <title>鼠标控制音乐播放的小程序</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
                <link href="http://upsuper.github.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="鬼の领地 Atom Feed" />
                
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">鬼の领地 </a></h1>
                <nav><ul>
                                                                                                    <li ><a href="./category/blog.html">Blog</a></li>
                                    <li ><a href="./category/research.html">Research</a></li>
                                    <li class="active"><a href="./category/script.html">Script</a></li>
                                    <li ><a href="./category/study.html">Study</a></li>
                                    <li ><a href="./category/technique.html">Technique</a></li>
                                </ul></nav>
        </header><!-- /#banner -->
        <section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="./use-mouse-as-music-player-controller.html" rel="bookmark"
           title="Permalink to 鼠标控制音乐播放的小程序">鼠标控制音乐播放的小程序</a></h1>
          </header>

    <div class="entry-content">
      <footer class="post-info">
        <abbr class="published" title="2009-11-03T20:06:00">
                2009&#24180;11&#26376;03&#26085;
        </abbr>

                <address class="vcard author">
                By <a class="url fn" href="./author/xidorn-quan.html">Xidorn Quan</a>
        </address>
        <p>In <a href="./category/script.html">Script</a>. </p>
<p>tags: <a href="./tag/python.html">Python</a><a href="./tag/gtk.html">GTK</a></p>
</footer><!-- /.post-info -->      <p>看这个标题一定很奇怪：难道我以前控制音乐播放不用鼠标么？这个文章的标题看起来像鼠标刚刚发明的推广期的文章……不过，当然不是这样的！</p>
<p>其实只是想：如何把我的小本合上放书架上，当作一个音乐播放器+功放，并用我的无线6键鼠当遥控器遥控控制之。</p>
<p>想想其实还是蛮有意义的功能，这样我做作业的时候可以不用戴耳机，不用用MP3，直接把本当播放器；同时，我不会看到屏幕上的东西，可以安心做作业~再看看我的6键无限鼠，那额外的功能键平时根本不用，也想不出能有什么用……这么好的东西就这样被我浪费了……（话说，拿本当音乐播放器是不是更浪费？）</p>
<p>说干就干！</p>
<p>首先提出构想：左键用于暂停和播放，滚轮调节音量，侧边的两个功能键用来切换上一首和下一首。至于右键和中键……再说吧，说不定以后可以扩展更多功能？说不定以后高兴了弄个鼠标手势什么的~嘿嘿</p>
<p>接下来查找资料。印象中我的 Audacious 是可以用 D-Bus 控制的。简单地查阅了一下相关资料，发现了一个叫做 MPRIS 的播放器控制接口。为此，我还专门学习了一下 python-dbus 的使用。</p>
<p>插一句话：python-dbus 怎么没有中文教程啊！英文教程看得还是蛮吃力的……</p>
<p>连接播放器的代码很简单：</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">dbus</span>
<span class="n">bus</span> <span class="o">=</span> <span class="n">dbus</span><span class="o">.</span><span class="n">SessionBus</span><span class="p">()</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="s">&#39;org.mpris.audacious&#39;</span><span class="p">,</span> <span class="s">&#39;/Player&#39;</span><span class="p">)</span>
</pre></div>


<p>其中 <code>org.mpris.audacious</code> 指的是 audacious，支持 MPRIS 的其他播放器还可以有如下：</p>
<ul>
<li><code>org.mpris.bmp</code></li>
<li><code>org.mpris.vlc</code></li>
<li><code>org.mpris.xmms2</code></li>
</ul>
<p>至于那个 <code>/Player</code> 指的是我们要获取的是一个叫 <code>Player</code> 的对象，用于控制播放器。在 MPRIS 中除了 <code>Player</code> 以外，还有根对象 (<code>/</code>) 和 <code>TrackList</code> 对象 (<code>/TrackList</code>) 两个，具体的用法其文档里详细说明。这里我只用到了 <code>Player</code> 对象……</p>
<p>看看 <code>Player</code> 对象的方法还挺多，这里我用了这几个：</p>
<ul>
<li><code>Next()</code> - 切换到下一首歌曲</li>
<li><code>Prev()</code> - 切换到上一首歌曲</li>
<li><code>Pause()</code> - 暂停/继续</li>
<li><code>Play()</code> - 播放歌曲</li>
<li><code>VolumeGet()</code> - 获取当前音量</li>
<li><code>VolumeSet()</code> - 设置音量</li>
</ul>
<p>根据前面写的需求，这些已经足够了~</p>
<p>怎么用这些？很简单嘛！就像平时在 Python 里面调用类的方法一样~类型转换？不，那完全不需要你关心！</p>
<p>Python 程序拥有控制播放器的能力了，可是鼠标呢？如何捕获鼠标的动作呢？</p>
<p>想想……屏幕都关了……你还能指望他为你显示什么呢？干脆建立一个窗口把整个屏幕盖住算了！然后让他截获鼠标事件。</p>
<p>快速学习了一下 pygtk 的用法（其实就是照着 Hello World 打了一遍），差不多就知道怎么用了。窗口的建立代码大约如下：</p>
<div class="codehilite"><pre><span class="n">window</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">WINDOW_TOPLEVEL</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">fullscreen</span><span class="p">()</span>
<span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>这段代码很好理解了，第一行就是创建窗口对象，第二行令其全屏，第三行设置其显示，第四行开始 GTK 的主循环。</p>
<p>下面就是鼠标事件的问题了~添加事件用的是类似下面的代码：</p>
<div class="codehilite"><pre><span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;key-press-event&#39;</span><span class="p">,</span> <span class="n">key_press</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;destroy&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">widget</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">gtk</span><span class="o">.</span><span class="n">main_quit</span><span class="p">())</span>
</pre></div>


<p>第一个是注册了键盘按键的事件捕获，将 <code>key-press-event</code> 事件绑定上 <code>key_press</code> 这个函数，而把窗口的销毁事件 <code>destroy</code> 连接到退出 GTK 主循环。说一句废话，连接事件的语句要放在 <code>gtk.main()</code> 之前……<code>key_press</code> 主要用来实现当点击 escape 时退出：</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">key_press</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">gdk</span><span class="o">.</span><span class="n">keyval_name</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">keyval</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Escape&#39;</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
</pre></div>


<p>好了，下面是鼠标点击事件 <code>button-press-event</code>：</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">button_press</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">event</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;button-press-event&#39;</span><span class="p">,</span> <span class="n">button_press</span><span class="p">)</span>
</pre></div>


<p>试试？不行的！差了一番后，发现 Window 这个东西默认是不打开鼠标点击的事件捕获的，逼近大家很少会点窗口本身，都是点里面的按钮什么的……下面的代码要求窗口打开鼠标点击事件的捕获：</p>
<div class="codehilite"><pre><span class="n">window</span><span class="o">.</span><span class="n">add_events</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">gdk</span><span class="o">.</span><span class="n">BUTTON_PRESS_MASK</span><span class="p">)</span>
</pre></div>


<p>接下来就可以了~<code>event.button</code> 表示的是点击的键是哪个。检查了一下，左键是1，右键是3，中键是2，功能键1是8，功能键2是9。滚轮呢？</p>
<p>原来滚轮有自己的事件 <code>scroll</code>。</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">scroll</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">event</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;scroll-event&#39;</span><span class="p">,</span> <span class="n">scroll</span><span class="p">)</span>
</pre></div>


<p>直接可以用了。识别滚轮方向的是 <code>event.direction</code>，应该是 <code>gtk.gdk.SCROLL_UP</code>、<code>SCROLL_DOWN</code>、<code>SCROLL_LEFT</code>、<code>SCROLL_RIGHT</code> 其中的一个。</p>
<p>下面根据最初的设想，把他们都拼起来就形成了最初的版本：</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">pygtk</span>
<span class="n">pygtk</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="s">&#39;2.0&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">gtk</span>
<span class="kn">from</span> <span class="nn">gtk</span> <span class="kn">import</span> <span class="n">gdk</span>

<span class="kn">import</span> <span class="nn">dbus</span>

<span class="k">def</span> <span class="nf">button_press</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="n">button</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span>
  <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">GetStatus</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">player</span><span class="o">.</span><span class="n">Play</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">player</span><span class="o">.</span><span class="n">Pause</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">Prev</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">Next</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">scroll</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">SCROLL_UP</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">VolumeSet</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">VolumeGet</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">SCROLL_DOWN</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">VolumeSet</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">VolumeGet</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">key_press</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">gdk</span><span class="o">.</span><span class="n">keyval_name</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">keyval</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Escape&#39;</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>

<span class="n">bus</span> <span class="o">=</span> <span class="n">dbus</span><span class="o">.</span><span class="n">SessionBus</span><span class="p">()</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="s">&#39;org.mpris.audacious&#39;</span><span class="p">,</span> <span class="s">&#39;/Player&#39;</span><span class="p">)</span>

<span class="n">window</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">WINDOW_TOPLEVEL</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;destroy&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">widget</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">gtk</span><span class="o">.</span><span class="n">main_quit</span><span class="p">())</span>
<span class="n">window</span><span class="o">.</span><span class="n">add_events</span><span class="p">(</span><span class="n">gdk</span><span class="o">.</span><span class="n">BUTTON_PRESS_MASK</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;button-press-event&#39;</span><span class="p">,</span> <span class="n">button_press</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;key-press-event&#39;</span><span class="p">,</span> <span class="n">key_press</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;scroll-event&#39;</span><span class="p">,</span> <span class="n">scroll</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">fullscreen</span><span class="p">()</span>
<span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>OK 看起来不错了，也能控制了。可是，作为一个程序员，怎么能不考虑各种意外呢？试想，如果我们控制着控制着，突然，一个不明真相的窗口弹了出来怎么办呢？！这是一个问题……</p>
<p>最容易想到的方法：把这个窗口永久置顶！</p>
<p>事实上也确实找到了这么个方法，就是把窗体注册成 dock。我们知道 dock 是需要永久置顶的~</p>
<p>用如下方法可以让窗体变成 Dock：</p>
<div class="codehilite"><pre><span class="n">window</span><span class="o">.</span><span class="n">set_type_hint</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">gdk</span><span class="o">.</span><span class="n">WINDOW_TYPE_HINT_DOCK</span><span class="p">)</span>
</pre></div>


<p>但是问题又来了：dock 似乎没法接受键盘输入。因为 dock 只是形式上覆盖，并且可以拦截一切在他上面发生的鼠标事件，可键盘焦点就未必在他那里了~</p>
<p>那么我们就不要键盘事件了吧~于是我就把键盘退出给删了，改成了双击退出~查了下资料，双击事件也通过 <code>button-press-event</code> 发送的，必须根据 <code>event.type</code> 来判断是单击、双击还是三击。此外，双击和三击中的每一次点击都会引发一次单击事件。</p>
<p>OK，于是我们把 button_press 函数改成下面这样：</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">button_press</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">_2BUTTON_PRESS</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">_3BUTTON_PRESS</span><span class="p">:</span>
    <span class="k">return</span>
  <span class="n">button</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span>
  <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">GetStatus</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">player</span><span class="o">.</span><span class="n">Play</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">player</span><span class="o">.</span><span class="n">Pause</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">Prev</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">Next</span><span class="p">()</span>
</pre></div>


<p>然后删掉键盘处理，最后就成了这样：</p>
<div class="codehilite"><pre><span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">pygtk</span>
<span class="n">pygtk</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="s">&#39;2.0&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">gtk</span>
<span class="kn">from</span> <span class="nn">gtk</span> <span class="kn">import</span> <span class="n">gdk</span>

<span class="kn">import</span> <span class="nn">dbus</span>

<span class="k">def</span> <span class="nf">button_press</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">_2BUTTON_PRESS</span><span class="p">:</span>
    <span class="n">window</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">_3BUTTON_PRESS</span><span class="p">:</span>
    <span class="k">return</span>
  <span class="n">button</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span>
  <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">player</span><span class="o">.</span><span class="n">GetStatus</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">player</span><span class="o">.</span><span class="n">Play</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">player</span><span class="o">.</span><span class="n">Pause</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">Prev</span><span class="p">()</span>
  <span class="k">elif</span> <span class="n">button</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">Next</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">scroll</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">SCROLL_UP</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">VolumeSet</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">VolumeGet</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
  <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">gdk</span><span class="o">.</span><span class="n">SCROLL_DOWN</span><span class="p">:</span>
    <span class="n">player</span><span class="o">.</span><span class="n">VolumeSet</span><span class="p">(</span><span class="n">player</span><span class="o">.</span><span class="n">VolumeGet</span><span class="p">()</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">bus</span> <span class="o">=</span> <span class="n">dbus</span><span class="o">.</span><span class="n">SessionBus</span><span class="p">()</span>
<span class="n">player</span> <span class="o">=</span> <span class="n">bus</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="s">&#39;org.mpris.audacious&#39;</span><span class="p">,</span> <span class="s">&#39;/Player&#39;</span><span class="p">)</span>

<span class="n">window</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">gtk</span><span class="o">.</span><span class="n">WINDOW_TOPLEVEL</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;destroy&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">widget</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">gtk</span><span class="o">.</span><span class="n">main_quit</span><span class="p">())</span>
<span class="n">window</span><span class="o">.</span><span class="n">add_events</span><span class="p">(</span><span class="n">gdk</span><span class="o">.</span><span class="n">BUTTON_PRESS_MASK</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;button-press-event&#39;</span><span class="p">,</span> <span class="n">button_press</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&#39;scroll-event&#39;</span><span class="p">,</span> <span class="n">scroll</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">set_type_hint</span><span class="p">(</span><span class="n">gdk</span><span class="o">.</span><span class="n">WINDOW_TYPE_HINT_DOCK</span><span class="p">)</span>
<span class="n">window</span><span class="o">.</span><span class="n">fullscreen</span><span class="p">()</span>
<span class="n">window</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>完成了！</p>
<p>以后就可以拿我的小本来当音乐播放器+功放啦~</p>
<p>参考资料：</p>
<ul>
<li><a href="http://wiki.xmms2.xmms.se/wiki/MPRIS">MPRIS – XMMS2</a></li>
<li><a href="http://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html">dbus-python tutorial</a></li>
<li><a href="http://www.pygtk.org/pygtk2tutorial/index.html">PyGTK 2.0 Tutorial</a></li>
<li><a href="http://library.gnome.org/devel/pygtk/stable/">PyGTK 2.0 Reference Manual</a></li>
<li><a href="http://www.daa.com.au/pipermail/pygtk/2004-January/006832.html">[pygtk] how to generate scroll wheel mouse event.</a></li>
<li><a href="http://topic.csdn.net/t/20030910/11/2243673.html">如何让窗口置顶？ Linux/Unix社区 / 程序开发区 – CSDN社区 community.csdn.net</a></li>
</ul>
    </div><!-- /.entry-content -->
    
  </article>
</section>
        <section id="extras" class="body">
                                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://upsuper.github.com/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            
                                                    <li><a href="https://twitter.com/upsuperx">Twitter</a></li>
                                                    <li><a href="https://github.com/upsuper">GitHub</a></li>
                                                </ul>
                </div><!-- /.social -->
                </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37354064-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>